# Render Blueprint for MCP-Web demo deployments
# https://docs.render.com/blueprint-spec
#
# This replaces Deno Deploy for demos that need single-process guarantees
# (WebSocket sessions and HTTP MCP requests must hit the same process).

services:
  - type: web
    name: mcp-web-todo
    runtime: node
    plan: free
    region: oregon
    buildCommand: |
      pnpm install &&
      pnpm build &&
      cd demos/todo &&
      cp ../deploy/todo/mcp-web.config.ts ./mcp-web.config.ts &&
      pnpm build &&
      cd ../.. &&
      pnpm bundle:servers &&
      cp -r demos/todo/dist demos/deploy/todo/static
    startCommand: node demos/deploy/todo/server.node.bundle.js
    healthCheckPath: /health
    domains:
      - todo.demo.mcp-web.dev
    buildFilter:
      paths:
        - demos/todo/**
        - demos/deploy/todo/**
        - demos/deploy/lib/**
        - packages/**
        - scripts/bundle-servers.ts
    envVars:
      - key: NODE_VERSION
        value: '24'

  - type: web
    name: mcp-web-higlass
    runtime: node
    plan: free
    region: oregon
    buildCommand: |
      pnpm install &&
      pnpm build &&
      cd demos/higlass &&
      cp ../deploy/higlass/mcp-web.config.ts ./mcp-web.config.ts &&
      pnpm build &&
      cd ../.. &&
      pnpm bundle:servers &&
      cp -r demos/higlass/dist demos/deploy/higlass/static
    startCommand: node demos/deploy/higlass/server.node.bundle.js
    healthCheckPath: /health
    domains:
      - higlass.demo.mcp-web.dev
    buildFilter:
      paths:
        - demos/higlass/**
        - demos/deploy/higlass/**
        - demos/deploy/lib/**
        - packages/**
        - scripts/bundle-servers.ts
    envVars:
      - key: NODE_VERSION
        value: '24'

  - type: web
    name: mcp-web-checkers
    runtime: node
    plan: free
    region: oregon
    buildCommand: |
      pnpm install &&
      pnpm build &&
      cd demos/checkers &&
      cp ../deploy/checkers/mcp-web.config.ts ./mcp-web.config.ts &&
      pnpm build &&
      cd ../.. &&
      pnpm bundle:servers &&
      cp -r demos/checkers/dist demos/deploy/checkers/static
    startCommand: node demos/deploy/checkers/server.node.bundle.js
    healthCheckPath: /health
    domains:
      - checkers.demo.mcp-web.dev
    buildFilter:
      paths:
        - demos/checkers/**
        - demos/deploy/checkers/**
        - demos/deploy/lib/**
        - packages/**
        - scripts/bundle-servers.ts
    envVars:
      - key: NODE_VERSION
        value: '24'

  - type: web
    name: mcp-web-checkers-agent
    runtime: node
    plan: free
    region: oregon
    buildCommand: |
      pnpm install &&
      pnpm build &&
      pnpm bundle:servers
    startCommand: node demos/deploy/checkers/agent.node.bundle.js
    healthCheckPath: /health
    domains:
      - checkers-agent.demo.mcp-web.dev
    buildFilter:
      paths:
        - demos/checkers/**
        - demos/deploy/checkers/**
        - packages/**
        - scripts/bundle-servers.ts
    envVars:
      - key: NODE_VERSION
        value: '24'
      - key: BRIDGE_URL
        value: 'https://checkers.demo.mcp-web.dev'
      - key: ALLOWED_ORIGINS
        value: 'https://checkers.demo.mcp-web.dev'
      - key: ANTHROPIC_API_KEY
        sync: false
      - key: OPENAI_API_KEY
        sync: false
      - key: GOOGLE_API_KEY
        sync: false
      - key: CEREBRAS_API_KEY
        sync: false
      - key: MODEL_PROVIDER
        sync: false
      - key: MODEL_NAME
        sync: false
